<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bucket Verification Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>ü™£ Bucket Verification Test</h1>
        <p class="lead">Let's check if your Firebase Storage bucket actually exists</p>
        
        <div class="card">
            <div class="card-body">
                <button onclick="testBucket()" class="btn btn-primary">Test Bucket Existence</button>
                <div id="results" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDjH30TDpQt8R5gm9vIm59HtfVnBGTmNtY",
            authDomain: "bigmountainclubwebsite.firebaseapp.com",
            projectId: "bigmountainclubwebsite",
            storageBucket: "bigmountainclubwebsite.appspot.com",
            messagingSenderId: "945172997417",
            appId: "1:945172997417:web:52437b0f24c3e186c8c338",
            measurementId: "G-7Q0EYRP98D"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        
        async function testBucket() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="alert alert-info">Testing bucket...</div>';
            
            try {
                console.log('Testing bucket existence...');
                
                // Test 1: Get storage reference
                const storageRef = storage.ref();
                console.log('‚úÖ Got storage reference');
                
                // Test 2: Try to list root files (should work even if empty)
                console.log('Trying to list root files...');
                const listResult = await storageRef.list({ maxResults: 1 });
                console.log('‚úÖ Successfully accessed bucket:', listResult);
                
                // Test 3: Create a test reference
                const testRef = storage.ref('test-file.txt');
                console.log('‚úÖ Created test reference:', testRef.fullPath);
                
                resultsDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h5>‚úÖ Storage Bucket is Working!</h5>
                        <ul>
                            <li>Bucket: ${firebaseConfig.storageBucket}</li>
                            <li>Root access: ‚úÖ Working</li>
                            <li>Reference creation: ‚úÖ Working</li>
                        </ul>
                        <p><strong>The bucket exists and is accessible. The upload issue is likely in the security rules.</strong></p>
                    </div>
                `;
                
            } catch (error) {
                console.error('Bucket test failed:', error);
                
                let diagnosis = '';
                if (error.code === 'storage/bucket-not-found') {
                    diagnosis = '‚ùå <strong>Storage bucket does not exist!</strong><br>You need to initialize Firebase Storage in the console.';
                } else if (error.code === 'storage/unauthorized') {
                    diagnosis = '‚ö†Ô∏è <strong>Storage access denied</strong><br>Security rules are blocking access.';
                } else if (error.code === 'storage/unknown') {
                    diagnosis = '‚ùì <strong>Unknown storage error</strong><br>Bucket might not be properly configured.';
                } else {
                    diagnosis = `üö® <strong>Error:</strong> ${error.message}`;
                }
                
                resultsDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>‚ùå Storage Bucket Test Failed</h5>
                        <p>${diagnosis}</p>
                        <hr>
                        <small>
                            <strong>Error Code:</strong> ${error.code || 'unknown'}<br>
                            <strong>Error Message:</strong> ${error.message}<br>
                            <strong>Full Error:</strong> <pre>${JSON.stringify(error, null, 2)}</pre>
                        </small>
                    </div>
                `;
            }
        }
        
        // Auto-run test
        window.addEventListener('load', () => {
            setTimeout(testBucket, 1000);
        });
    </script>
</body>
</html>