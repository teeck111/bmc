<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Test</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Database Connection Test</h1>
    <div id="status">Testing...</div>
    <div id="logs" style="background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-line;"></div>
    
    <button onclick="testDatabase()">Test Database</button>
    
    <script src="firebase-config.js"></script>
    <script>
        const logs = document.getElementById('logs');
        const status = document.getElementById('status');
        
        function addLog(message) {
            console.log(message);
            logs.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }
        
        // Override console methods to capture logs without infinite recursion
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logs.textContent += new Date().toLocaleTimeString() + ': ' + args.join(' ') + '\n';
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logs.textContent += new Date().toLocaleTimeString() + ': ERROR: ' + args.join(' ') + '\n';
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logs.textContent += new Date().toLocaleTimeString() + ': WARN: ' + args.join(' ') + '\n';
        };
        
        // Test database functionality
        async function testDatabase() {
            addLog('Testing database functionality...');
            
            if (typeof dbManager !== 'undefined' && dbManager) {
                addLog('dbManager is available');
                try {
                    const trips = await dbManager.getTrips();
                    addLog('Successfully loaded ' + trips.length + ' trips');
                    status.textContent = 'Database working! Loaded ' + trips.length + ' trips.';
                    status.style.color = 'green';
                } catch (error) {
                    addLog('Error loading trips: ' + error.message);
                    status.textContent = 'Error loading trips: ' + error.message;
                    status.style.color = 'red';
                }
            } else if (typeof window.dbManager !== 'undefined' && window.dbManager) {
                addLog('window.dbManager is available');
                try {
                    const trips = await window.dbManager.getTrips();
                    addLog('Successfully loaded ' + trips.length + ' trips');
                    status.textContent = 'Database working! Loaded ' + trips.length + ' trips.';
                    status.style.color = 'green';
                } catch (error) {
                    addLog('Error loading trips: ' + error.message);
                    status.textContent = 'Error loading trips: ' + error.message;
                    status.style.color = 'red';
                }
            } else {
                addLog('dbManager is not available');
                status.textContent = 'dbManager not found!';
                status.style.color = 'red';
            }
        }
        
        // Test on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                addLog('Page fully loaded, checking dbManager...');
                if (typeof dbManager !== 'undefined' && dbManager) {
                    addLog('dbManager found: ' + typeof dbManager);
                    status.textContent = 'dbManager loaded successfully';
                    status.style.color = 'green';
                } else if (typeof window.dbManager !== 'undefined' && window.dbManager) {
                    addLog('window.dbManager found: ' + typeof window.dbManager);
                    status.textContent = 'window.dbManager loaded successfully';
                    status.style.color = 'green';
                } else {
                    addLog('dbManager not found');
                    status.textContent = 'dbManager not found';
                    status.style.color = 'red';
                }
            }, 1000);
        });
    </script>
</body>
</html>